import { initVideoModal } from "./videoModal.min.js";
import { initSlideshow } from "./textSlideshow.min.js";
const routerView = document.getElementById("routerView");
const videoButtons = document.getElementsByTagName("button");
const previewScreen = document.querySelector("#preview");

export const routes = {
    index: `/pages/about.html`,
    projects: `/pages/projects.html`,
    404: "/pages/404.html",
};

export async function navigate(route) {
    const routePath = routes[route] || routes["404"];
    try {
        const response = await fetch(routePath);
        const routeContent = await response.text();
        routerView.classList.add("opacity-0");
        setTimeout(() => {
            setTimeout(() => {
                previewScreen.classList.add("opacity-0");
                setTimeout(() => {
                    previewScreen.remove();
                }, 500);
            }, 2500);
            routerView.innerHTML = routeContent;
            if (isMobileDevice()) {
                if (document.querySelector('#desktop-version')) { document.querySelector('#desktop-version').remove() }
                if (document.querySelector('#mobile-version')) { document.querySelector('#mobile-version').classList.add("flex") }
                if (route === "index") {
                    initSlideshow();
                }
                if (document.getElementById('menu-button')) {
                    document.getElementById('menu-button').addEventListener('click', () => {
                        const menu = document.getElementById('mobile-menu');
                        menu.classList.toggle('opacity-0');
                        menu.classList.toggle('opacity-100');
                        menu.classList.toggle('hidden');
                        menu.classList.toggle('flex');
                    });
                }
                if (document.getElementById('close-burger')) {
                    document.getElementById('close-burger').addEventListener('click', () => {
                        const menu = document.getElementById('mobile-menu');
                        menu.classList.toggle('opacity-0');
                        menu.classList.toggle('opacity-100');
                        menu.classList.toggle('hidden');
                        menu.classList.toggle('flex');
                    })
                }
            } else {
                if (document.querySelector('#mobile-version')) { document.querySelector('#mobile-version').remove(); }
                if (document.querySelector('#desktop-version')) { document.querySelector('#desktop-version').classList.add("grid"); }
            }
            if (route === "index") {
                initSlideshow();
            }
            initVideoModal(videoButtons);
            routerView.classList.remove("opacity-0");
            routerView.classList.add("opacity-100");
        }, 100);
    } catch (error) {
        console.error("ERROR: ", error);
        navigate("404");
    }
}

export function handleRouteChange() {
    const path = window.location.pathname.substring(1) || "index";
    navigate(path);
}

function isMobileDevice() {
    return /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}